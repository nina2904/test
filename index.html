<!DOCTYPE html>
<html lang="ja">
    <head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>LAテスト用</title>
        <meta name="robots" content="noindex,nofollow">

		<script type="text/javascript">
			window.lpTag=window.lpTag||{},'undefined'==typeof window.lpTag._tagCount?(window.lpTag={wl:lpTag.wl||null,scp:lpTag.scp||null,site:'72494770'||'',section:lpTag.section||'',tagletSection:lpTag.tagletSection||null,autoStart:lpTag.autoStart!==!1,ovr:lpTag.ovr||{},_v:'1.10.0',_tagCount:1,protocol:'https:',events:{bind:function(t,e,i){lpTag.defer(function(){lpTag.events.bind(t,e,i)},0)},trigger:function(t,e,i){lpTag.defer(function(){lpTag.events.trigger(t,e,i)},1)}},defer:function(t,e){0===e?(this._defB=this._defB||[],this._defB.push(t)):1===e?(this._defT=this._defT||[],this._defT.push(t)):(this._defL=this._defL||[],this._defL.push(t))},load:function(t,e,i){var n=this;setTimeout(function(){n._load(t,e,i)},0)},_load:function(t,e,i){var n=t;t||(n=this.protocol+'//'+(this.ovr&&this.ovr.domain?this.ovr.domain:'lptag.liveperson.net')+'/tag/tag.js?site='+this.site);var o=document.createElement('script');o.setAttribute('charset',e?e:'UTF-8'),i&&o.setAttribute('id',i),o.setAttribute('src',n),document.getElementsByTagName('head').item(0).appendChild(o)},init:function(){this._timing=this._timing||{},this._timing.start=(new Date).getTime();var t=this;window.attachEvent?window.attachEvent('onload',function(){t._domReady('domReady')}):(window.addEventListener('DOMContentLoaded',function(){t._domReady('contReady')},!1),window.addEventListener('load',function(){t._domReady('domReady')},!1)),'undefined'===typeof window._lptStop&&this.load()},start:function(){this.autoStart=!0},_domReady:function(t){this.isDom||(this.isDom=!0,this.events.trigger('LPT','DOM_READY',{t:t})),this._timing[t]=(new Date).getTime()},vars:lpTag.vars||[],dbs:lpTag.dbs||[],ctn:lpTag.ctn||[],sdes:lpTag.sdes||[],hooks:lpTag.hooks||[],identities:lpTag.identities||[],ev:lpTag.ev||[]},lpTag.init()):window.lpTag._tagCount+=1;
        	/*lpTag がグローバルオブジェクトとして存在しているか確認*/
			console.log(window.lpTag);
            /*コードスニペット部分*/
            (function(t){window.lpTag=window.lpTag||{};if(typeof window.lpTag._tagCount==="undefined"){window.lpTag={site:t,section:lpTag.section||"",autoStart:lpTag.autoStart===false?false:true,ovr:lpTag.ovr||{},_v:"1.6.0",_tagCount:1,protocol:"https:",events:{bind:function(t,e,o){lpTag.defer(function(){lpTag.events.bind(t,e,o)},0)},trigger:function(t,e,o){lpTag.defer(function(){lpTag.events.trigger(t,e,o)},1)}},defer:function(t,e){if(e==0){this._defB=this._defB||[];this._defB.push(t)}else if(e==1){this._defT=this._defT||[];this._defT.push(t)}else{this._defL=this._defL||[];this._defL.push(t)}},load:function(t,e,o){var s=this;setTimeout(function(){s._load(t,e,o)},0)},_load:function(t,e,o){var s=t;if(!t){s=this.protocol+"//"+(this.ovr&&this.ovr.domain?this.ovr.domain:"lptag.liveperson.net")+"/tag/tag.js?site="+this.site}var n=document.createElement("script");n.setAttribute("charset",e?e:"UTF-8");if(o){n.setAttribute("id",o)}n.setAttribute("src",s);document.getElementsByTagName("head").item(0).appendChild(n)},init:function(){this._timing=this._timing||{};this._timing.start=(new Date).getTime();var t=this;if(window.attachEvent){window.attachEvent("onload",function(){t._domReady("domReady")})}else{window.addEventListener("DOMContentLoaded",function(){t._domReady("contReady")},false);window.addEventListener("load",function(){t._domReady("domReady")},false)}if(typeof window._lptStop=="undefined"){this.load()}},start:function(){this.autoStart=true},_domReady:function(t){if(!this.isDom){this.isDom=true;this.events.trigger("LPT","DOM_READY",{t:t})}this._timing[t]=(new Date).getTime()},vars:lpTag.vars||[],dbs:lpTag.dbs||[],ctn:lpTag.ctn||[],sdes:lpTag.sdes||[],ev:lpTag.ev||[]};lpTag.init()}else{window.lpTag._tagCount+=1}window.cafexAssistBootstrap={};window.cafexAssistBootstrap.laBootstrapLoaded=false;window.cafexAssistBootstrap.cobrowseState;window.cafexAssistBootstrap.bootstrapLa=function(t){var e=document.getElementById("assist-cobrowse-bootstrap-script");if(e){e.parentNode.removeChild(e)}var o=t+"/assist-bootstrap/assist-bootstrap.js";var s=document.createElement("script");s.id="assist-cobrowse-bootstrap-script";s.type="text/javascript";s.src=o;window.cafexAssistBootstrap.cobrowseBootstrapLoaded=function(){window.cafexAssistBootstrap.laBootstrapLoaded=true;switch(window.cafexAssistBootstrap.cobrowseState){case"accepted":window.cafexAssistBootstrap.cobrowseAccepted(window.cafexAssistBootstrap.agentId);break;case"rejected":window.cafexAssistBootstrap.cobrowseRejected(window.cafexAssistBootstrap.agentId);break}};document.head.appendChild(s)};let e=sessionStorage.getItem("cobrowseServer");if(T(e)){window.cafexAssistBootstrap.bootstrapLa(e)}else if(e){console.warn("Unexpected cobrowseServer domain: "+e+" aborting.")}lpTag.events.bind({eventName:"cobrowseOffered",appName:"*",func:function(t){console.log(t);window.cafexAssistBootstrap.cobrowseState="offered";var e=document.querySelectorAll("[data-assist-a"+t.agentId+"]");var o=JSON.parse(atob(e[e.length-1].dataset["assistA"+t.agentId]));console.log(o);if(T(o.server)===false){return}sessionStorage.setItem("cobrowseServer",o.server);window.cafexAssistBootstrap.bootstrapLa(o.server)},async:true});lpTag.events.bind({eventName:"cobrowseAccepted",appName:"*",func:function(t){console.log(t);window.cafexAssistBootstrap.cobrowseState="accepted";window.cafexAssistBootstrap.agentId=t.agentId;if(window.cafexAssistBootstrap.laBootstrapLoaded){window.cafexAssistBootstrap.cobrowseAccepted(t.agentId)}},async:true});lpTag.events.bind({eventName:"cobrowseDeclined",appName:"*",func:function(t){console.log(t);window.cafexAssistBootstrap.cobrowseState="rejected";window.cafexAssistBootstrap.agentId=t.agentId;if(window.cafexAssistBootstrap.laBootstrapLoaded){window.cafexAssistBootstrap.cobrowseRejected(t.agentId)}},async:true});function n(t,e){let o=s(t,e);document.dispatchEvent(o)}function s(e,o){let s;if(typeof window.CustomEvent==="function"){s=new CustomEvent(e,o)}else{let t=o||{bubbles:false,cancelable:false,detail:undefined};s=document.createEvent("CustomEvent");s.initCustomEvent(e,t.bubbles,t.cancelable,t.detail)}return s}document.addEventListener("click",function(s){if(s.target.dataset&&s.target.dataset.event!==undefined){try{let e=JSON.parse(s.target.dataset.event);let o=u(e.useRecentData,s.target.parentElement.dataset.bootStrap);r(e);c(e);S(s.target.parentElement.dataset.bootStrap,function(t){g(t);n(e.event,o)})}catch(t){console.log("could not process"+s.target.dataset.event+" "+t)}}});lpTag.events.bind({eventName:"state",appName:"*",func:function(t){if(t.state==="ended"){d()}},async:true});const o="liveAssistScripts";const a="liveAssistElements";const i="deleteLiveAssistScript";function d(){var t=document.querySelectorAll("[data-event]");t.forEach(function(t){let e=JSON.parse(t.dataset.event);r(e,true)})}function r(t,e){let o=document.getElementById(t.id);if(t.oneTime||e){o.disabled=true;if(typeof t.disabledStyle!=="undefined"){o.style.cssText=t.disabledStyle}o.style.cssText+="pointer-events: none;"}}function c(t){const e="element already exists in local storage list";m(sessionStorage,t,e,a)}function l(){let e=JSON.parse(sessionStorage.getItem(a));let o=[];for(let t in e){if(e[t].oneTime){o.push(p(e[t]))}}if(o.length!==0){f(o)}}function f(t){let e=document.head||document.getElementsByTagName("head")[0];let o=document.createElement("style");o.type="text/css";t.forEach(function(t){o.appendChild(document.createTextNode(t))});e.appendChild(o)}function p(t){let e="#"+t.id+"{";let o=t.disabledStyle.split(";");o.forEach(function(t){e+=t+" !important;"});e+="pointer-events: none;";e+="}";return e}function u(t,e){let n={detail:{data:e}};if(t){let o=JSON.parse(e).id;let s=document.querySelectorAll("[data-boot-strap]");for(let e=s.length-1;e>0;e--){let t=s[e].dataset["bootStrap"];if(JSON.parse(t).id===o){n={detail:{data:t}};break}}}return n}function g(t){const e="script already exists in local storage list";m(localStorage,t,e,o)}function m(t,e,o,s){let n=JSON.parse(t.getItem(s));if(!n){n={}}if(n[e.id]===undefined){n[e.id]=e;t.setItem(s,JSON.stringify(n));console.log("adding"+e.id+" to storage")}else{console.log(o)}}function w(t){v(localStorage,t,o)}function v(t,e,o){let s=JSON.parse(t.getItem(o));if(delete s[e]===false){console.log("script"+e+"does not exist in list")}t.setItem(o,JSON.stringify(s))}function b(t){let e=document.getElementById(t);if(e){e.parentNode.removeChild(e);e=null;console.log("script"+t+" removed from dom")}}function h(t,e){let o=document.getElementById(t.id);if(T(t.bootstrapJs)===false){console.log("script not in valid domain");return}if(o){o.parentNode.removeChild(o);o=null}o=document.createElement("script");o.id=t.id;o.async=true;o.onload=function(){e(t)};o.src=t.bootstrapJs;document.body.appendChild(o)}function S(t,e){let o=JSON.parse(t);if(o){h(o,e);return true}return false}function y(){let e=JSON.parse(localStorage.getItem(o));console.log("restoring scripts using local storage");for(let t in e){h(e[t],function(){console.log("script"+t+"restored")})}}document.addEventListener(i,function(t){b(t.detail.id);w(t.detail.id)},false);document.addEventListener("DOMContentLoaded",function(t){y();l()});function T(t){const e=[".cafex.com",".liveassistcloud.com",".liveassistfor365.com"];let o=false;let s=document.createElement("a");s.href=t;let n=s.hostname;for(let t=0;t<e.length;t++){if(n.endsWith(e[t])){o=true;break}}if(!o){console.log("Unexpected domain "+n+" aborting...")}return o}})(72494770);
			
			/*ユーザ情報認証部*/
			lpTag.identities=[];
			lpTag.identities.push(identityFn);
			function identityFn(callback) {
    			callback({
        			iss: "https://nina2904.github.io/test/",
        			acr: "loa1",
        			sub: "e261ae02-ecfa-ee11-9f8a-002248687420"
				});
			}
            
            /*1 . ローカルストレージ情報の削除*/
            localStorage.removeItem("jwt");

            /*------ここからソフィア対応不可(webアプリケーションサーバから取得したjwtをローカルストレージに格納するところまで)------*/
            /*2 . アプリケーションサーバからJWTを取得する(テスト用なのでJWTは仮のものを直接入力)*/
            const resJwt = "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJlMjYxYWUwMi1lY2ZhLWVlMTEtOWY4YS0wMDIyNDg2ODc0MjAiLCJnaXZlbl9uYW1lIjoi5aSq6YOOIiwiZmFtaWx5X25hbWUiOiLkvZDol6QiLCJpc3MiOiJodHRwczovL25pbmEyOTA0LmdpdGh1Yi5pby90ZXN0LyIsImlhdCI6MTc0ODg0ODkyMCwiZXhwIjoxNzg0ODg1NzgyfQ.6tpFy1Bkhehgmjx2mn2BW37vGXZ97zOmOxZo8fOGlNI11DKYSs5KHIIK379VgM7ku8JRo5Zd_yFD2ygW_84ZM4VNKwHyUEWOZOuGprHWJiVrGBYYuI99QdXPvngBaeMqWDJ2jzDHUXPTrzenFGox2WyzVzFiK_3cW6uZN1t1cyvWRfBByloU5KLMHc_2Dr-wKuZHB1sL3XLEHeSwTaeqegh_qTrK_p1BvBZTHP8B7WsDSj8DoUv4gedFYn3x35ecO8mqjgWiNNwXRwYbrvnHtWjGF3ZiEuK3Qw0RNPHDvdNyVc3B16ObyqR8pjQ5cuPjH4uNdYrzJ968_t0DECsv1Q";
            /*取得したresJwtをsetJwtに格納する。*/
            let setJwt = {
                testjwtdata: resJwt
            };
            /*3 . ローカルストレージに取得したJWTを格納する(キーはjwt)*/
            localStorage.setItem("jwt", JSON.stringify(setJwt));
            /*------ここまでソフィア対応不可------*/

            /*------ここからソフィア代筆(ローカルストレージからjwtを取得し、該当メソッドにJWTを渡すところまで)------*/
            /*4 . ローカルストレージからJWTを取り出す(キーはjwt)*/
            let getJwt = JSON.parse(localStorage.getItem("jwt"));

            /*5 . LiveAssistに設定した該当メソッドに取得したJWTを渡す*/
            function authoriseChatWithCallback(callback) {
                /*メソッド実行時に出力*/
                console.log("Get JWT");
                try {
                    /*Webアプリケーションサーバから取得したJWTを出力*/
                    console.log("JWT from Web Application: " + getJwt.testjwtdata);
			callback(getJwt.testjwtdata); 
                } catch (e) {
                    /*JWTがnullだった場合、「JWT from Web Application: Unable to generate key」を出力させる*/
                    console.error(e);
                    callback(null, "Unable to generate key");
                }
            };
            /*JWT取得用メソッドの実行*/
            /*------ここまでソフィア代筆------*/
        </script>
    </head>
    <body>
	    <div id="LP_DIV_1752717573217"></div>
    </body>
</html>
